<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Account — Viral Dead Engine</title>
<link rel="stylesheet" href="/assets/styles.css">
<style>
.panel{border:1px solid rgba(255,255,255,.12);border-radius:16px;background:#151515;padding:16px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
.input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:#0f0f0f;color:#fff}
</style>
<script>
  // Set your backend base URL once (persists in browser)
  // Example: https://YOUR-BACKEND.onrender.com
  const DEFAULT_API_BASE = localStorage.getItem("vd_api_base") || "http://localhost:8000";
</script>
</head><body>
<div class="wrap">
  <div class="top">
    <div><h1 style="margin:0 0 6px">Account</h1><p style="margin:0;opacity:.82">Log in, confirm access, and manage billing.</p></div>
    <div class="nav"><a href="/">Home</a> · <a href="/blog.html">Blog</a> · <a href="/checkout.html">Get access</a></div>
  </div>

  <div class="panel">
    <p style="margin:0 0 10px"><b>API base URL</b> (your backend). Set once if you’re testing locally.</p>
    <input id="apiBase" class="input" placeholder="https://your-api-domain" />
    <div class="row">
      <button class="ts-btn" id="saveApi" type="button">Save</button>
      <button class="ts-btn" id="meBtn" type="button">Check /auth/me</button>
      <button class="ts-btn" id="portalBtn" type="button">Manage billing</button>
    </div>
    <div id="msg" style="margin-top:10px;opacity:.85"></div>
  </div>

  <div class="panel" style="margin-top:14px">
    <p style="margin:0 0 10px"><b>Login token</b> is stored in your browser as <code>vd_token</code> after login.</p>
    <div class="row">
      <a class="ts-btnlink" data-track="account_login" href="/login.html">Go to Login →</a>
      <a class="ts-btnlink" data-track="account_success" href="/success.html">Success page →</a>
    </div>
  </div>
</div>

<script>
  const msg = (t)=>document.getElementById("msg").textContent=t;
  const apiBaseInput = document.getElementById("apiBase");
  apiBaseInput.value = DEFAULT_API_BASE;

  document.getElementById("saveApi").onclick = ()=>{
    localStorage.setItem("vd_api_base", apiBaseInput.value.trim());
    msg("Saved API base.");
  };

  async function authedFetch(path, opts={}){
    const api = (localStorage.getItem("vd_api_base")||DEFAULT_API_BASE).replace(/\/$/,"");
    const token = localStorage.getItem("vd_token") || "";
    const headers = Object.assign({"Content-Type":"application/json"}, opts.headers||{});
    if(token) headers["Authorization"] = "Bearer " + token;
    const res = await fetch(api + path, Object.assign({}, opts, {headers}));
    const data = await res.json().catch(()=>({}));
    if(!res.ok) throw new Error(data.detail || "Request failed");
    return data;
  }

  document.getElementById("meBtn").onclick = async ()=>{
    try{
      const me = await authedFetch("/auth/me", {method:"GET"});
      msg("Logged in as: " + me.email);
    }catch(e){ msg(e.message); }
  };

  document.getElementById("portalBtn").onclick = async ()=>{
    try{
      const out = await authedFetch("/stripe/create-portal-session", {method:"POST", body: JSON.stringify({return_url: "https://viraldead.pro/account.html"})});
      window.location.href = out.url;
    }catch(e){ msg(e.message); }
  };
</script>
<script src="/assets/turnstile.js"></script>

  <div class="divider"></div>
  <div class="footer-links">
    <b>Our network:</b>
    <a href="https://deadapp.pro" target="_blank" rel="noopener">DeadApp.pro</a> ·
    <a href="https://insuretoday24.com" target="_blank" rel="noopener">InsureToday24.com</a> ·
    <a href="https://viraldead.pro" target="_blank" rel="noopener">ViralDead.pro</a>
  </div>

</body></html>
